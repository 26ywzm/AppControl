<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>应用程序控制器 - 动态加载版</title>
</head>
<body>
    <h1>应用程序控制器</h1>
    
    <!-- 应用程序列表将被动态加载到这里 -->
    <div id="appList"></div>

    <script>
        // 从服务器获取应用程序列表
        async function loadApplications() {
            try {
                const response = await fetch('http://localhost:3001/api/applications');
                const apps = await response.json();
                const container = document.getElementById('appList');
                
                apps.forEach(app => {
                    const appDiv = document.createElement('div');
                    appDiv.className = 'app-control';
                    appDiv.innerHTML = `
                        <h2>${app.name}</h2>
                        <p class="description">${app.description || ''}</p>
                        <div class="button-group">
                            <button class="start-btn" onclick="controlApp('${app.id}', 'start')">启动${app.name}</button>
                            <button class="stop-btn" onclick="controlApp('${app.id}', 'stop')">关闭${app.name}</button>
                        </div>
                        <div id="${app.id}-status" class="status"></div>
                    `;
                    container.appendChild(appDiv);
                });
            } catch (error) {
                console.error('加载应用程序列表失败:', error);
                document.getElementById('appList').innerHTML = '<p style="color: red;">加载应用程序列表失败</p>';
            }
        }

        // 控制应用程序
        async function controlApp(appId, action) {
            try {
                const response = await fetch(`http://localhost:3001/${action}/${appId}`);
                const data = await response.json();
                document.getElementById(`${appId}-status`).textContent = data.message || data.error;
            } catch (error) {
                document.getElementById(`${appId}-status`).textContent = '控制应用程序时发生错误';
                console.error('控制应用程序时发生错误:', error);
            }
        }

        // 添加样式
        const style = document.createElement('style');
        style.textContent = `
            body {
                font-family: Arial, sans-serif;
                max-width: 800px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f0f0f0;
            }
            .app-control {
                background-color: white;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 20px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .description {
                color: #666;
                margin: 5px 0 15px 0;
                font-size: 14px;
            }
            .button-group {
                display: flex;
                gap: 10px;
            }
            .start-btn, .stop-btn {
                padding: 10px 20px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                transition: background-color 0.3s;
            }
            .start-btn {
                background-color: #4CAF50;
                color: white;
            }
            .stop-btn {
                background-color: #f44336;
                color: white;
            }
            .start-btn:hover, .stop-btn:hover {
                opacity: 0.9;
            }
            .status {
                margin-top: 10px;
                color: #666;
            }
        `;
        document.head.appendChild(style);

        // 页面加载时获取应用程序列表
        window.addEventListener('load', loadApplications);
    </script>
</body>
</html>
